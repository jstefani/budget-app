<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Budget Tracker</h1>
                <nav class="header-nav">
                    <a href="#income-section" class="nav-link">Income</a>
                    <a href="#expenses-section" class="nav-link">Expenses</a>
                </nav>
                <div class="header-actions">
                    <button id="upgradeAccountBtn" class="upgrade-btn" onclick="budgetTracker.showUpgradeModal()" style="display: none;">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
                        </svg>
                        Create Account
                    </button>
                    <div id="userInfo" class="user-info" style="display: none;">
                        <span id="userEmail" class="user-email"></span>
                        <button id="logoutBtn" class="logout-btn" onclick="budgetTracker.logout()">Logout</button>
                    </div>
                </div>
            </div>
            <div class="remaining-budget">
                <span class="label">Remaining Budget</span>
                <span class="amount" id="remainingAmount">$0.00</span>
                <div class="budget-details">
                    <span class="days-left" id="daysLeft">0 days left in month</span>
                    <span class="daily-allowance">You can spend <span id="dailyAllowance">$0.00</span> per day</span>
                </div>
            </div>
        </header>

        <main>
            <section class="spending-section">
                <h2>Daily Spending</h2>
                <form id="spendingForm">
                    <div class="form-group">
                        <label for="spendingAmount">Amount:</label>
                        <input type="number" id="spendingAmount" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="spendingDescription">Description:</label>
                        <input type="text" id="spendingDescription" placeholder="e.g., Coffee, Groceries">
                    </div>
                    <button type="submit">Record Spending</button>
                </form>
                <div id="spendingList" class="entry-list"></div>
            </section>

            <section id="income-section" class="income-section">
                <h2>Monthly Income</h2>
                <form id="incomeForm">
                    <div class="form-group">
                        <label for="incomeDay">Day:</label>
                        <input type="number" id="incomeDay" min="1" max="31" placeholder="Day of month" required>
                    </div>
                    <div class="form-group">
                        <label for="incomeAmount">Amount:</label>
                        <input type="number" id="incomeAmount" step="0.01" min="0" required>
                    </div>
                    <button type="submit">Add Income</button>
                </form>
                <div id="incomeList" class="entry-list"></div>
            </section>

            <section id="expenses-section" class="expenses-section">
                <h2>Fixed Expenses</h2>
                <form id="expensesForm">
                    <div class="form-group">
                        <label for="expenseAmount">Amount:</label>
                        <input type="number" id="expenseAmount" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseDay">Due Day (optional):</label>
                        <input type="number" id="expenseDay" min="1" max="31" placeholder="Day of month">
                    </div>
                    <div class="form-group">
                        <label for="expenseDescription">Description:</label>
                        <input type="text" id="expenseDescription" placeholder="e.g., Rent, Utilities">
                    </div>
                    <button type="submit">Add Fixed Expense</button>
                </form>
                <div id="expensesList" class="entry-list"></div>
            </section>
        </main>
    </div>

    <!-- Sync Status Footer -->
    <footer class="sync-status-footer">
        <div id="syncStatus" class="sync-status" style="display: none;">
            <div id="syncStatusIcon" class="sync-icon"></div>
            <span id="syncStatusText">Local only</span>
        </div>
    </footer>

    <!-- Onboarding Modal -->
    <div id="onboardingModal" class="onboarding-overlay">
        <div class="onboarding-modal">
            <!-- Welcome Screen -->
            <div id="onboarding-welcome" class="onboarding-step active">
                <h2>Hi!</h2>
                <p>This is an app to help you not be broke at the end of the month.</p>
                <p>Let's get started - do you have a job or source of income?</p>
                <p class="subtitle">If not, we can just start with however much money is in your bank account.</p>
                <div class="onboarding-buttons">
                    <button class="onboarding-btn primary" onclick="budgetTracker.onboarding.goToIncome()">I have a job/income</button>
                    <button class="onboarding-btn secondary" onclick="budgetTracker.onboarding.goToBankAccount()">Money in my bank account</button>
                </div>
            </div>

            <!-- Income Setup -->
            <div id="onboarding-income" class="onboarding-step">
                <h2>Income Setup</h2>
                <form id="onboardingIncomeForm">
                    <div class="form-group">
                        <label for="onboardingIncomeAmount">Income amount:</label>
                        <input type="number" id="onboardingIncomeAmount" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="onboardingIncomeName">Name (optional):</label>
                        <input type="text" id="onboardingIncomeName" placeholder="e.g., Main Job, Freelancing">
                    </div>
                    <div class="form-group">
                        <label for="onboardingPayDays">What days are you paid on?</label>
                        <input type="text" id="onboardingPayDays" placeholder="e.g., 1st and 15th, or just 30th">
                    </div>
                    <div class="onboarding-buttons">
                        <button type="button" class="onboarding-btn secondary" onclick="budgetTracker.onboarding.goBack()">Back</button>
                        <button type="submit" class="onboarding-btn primary">Continue</button>
                    </div>
                </form>
            </div>

            <!-- Bank Account Setup -->
            <div id="onboarding-bank" class="onboarding-step">
                <h2>Starting Amount</h2>
                <form id="onboardingBankForm">
                    <div class="form-group">
                        <label for="onboardingBankAmount">How much money do you want to start with?</label>
                        <input type="number" id="onboardingBankAmount" step="0.01" min="0" required>
                    </div>
                    <div class="onboarding-buttons">
                        <button type="button" class="onboarding-btn secondary" onclick="budgetTracker.onboarding.goBack()">Back</button>
                        <button type="submit" class="onboarding-btn primary">Continue</button>
                    </div>
                </form>
            </div>

            <!-- Additional Income -->
            <div id="onboarding-additional" class="onboarding-step">
                <h2>Additional Income</h2>
                <p>Do you have any other monthly source of income you want to include?</p>
                <div class="onboarding-buttons">
                    <button class="onboarding-btn secondary" onclick="budgetTracker.onboarding.skipAdditional()">No, continue</button>
                    <button class="onboarding-btn primary" onclick="budgetTracker.onboarding.addAdditionalIncome()">Yes, add more income</button>
                </div>
                
                <div id="additionalIncomeForm" class="additional-income-form" style="display: none;">
                    <form id="onboardingAdditionalForm">
                        <div class="form-group">
                            <label for="onboardingAdditionalAmount">Additional income amount:</label>
                            <input type="number" id="onboardingAdditionalAmount" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="onboardingAdditionalName">Name:</label>
                            <input type="text" id="onboardingAdditionalName" placeholder="e.g., Side hustle, Rental income">
                        </div>
                        <div class="form-group">
                            <label for="onboardingAdditionalDays">Payment days (optional):</label>
                            <input type="text" id="onboardingAdditionalDays" placeholder="e.g., 5th of month">
                        </div>
                        <div class="onboarding-buttons">
                            <button type="submit" class="onboarding-btn primary">Add This Income</button>
                        </div>
                    </form>
                    <div class="onboarding-buttons">
                        <button class="onboarding-btn secondary" onclick="budgetTracker.onboarding.goToIncomeSummary()">Continue to expenses</button>
                    </div>
                </div>
            </div>

            <!-- Income Summary -->
            <div id="onboarding-income-summary" class="onboarding-step">
                <h2>Great!</h2>
                <p>It looks like every month you have <span id="totalIncomeAmount" class="highlight-amount">$0</span> to spend.</p>
                <p>Next let's add recurring expenses like your housing, car, etc.</p>
                <div class="onboarding-buttons">
                    <button class="onboarding-btn secondary" onclick="budgetTracker.onboarding.goBack()">Back</button>
                    <button class="onboarding-btn primary" onclick="budgetTracker.onboarding.goToExpenses()">Next</button>
                </div>
            </div>

            <!-- Expenses Setup -->
            <div id="onboarding-expenses" class="onboarding-step">
                <h2>Monthly Expenses</h2>
                <p>Let's add your recurring monthly expenses:</p>
                
                <div class="expense-categories">
                    <div class="expense-category">
                        <h3>Housing</h3>
                        <form class="expense-form">
                            <input type="number" placeholder="Rent/Mortgage" step="0.01" min="0" data-name="Rent/Mortgage">
                            <input type="number" placeholder="Utilities (optional)" step="0.01" min="0" data-name="Utilities">
                            <input type="number" placeholder="Internet (optional)" step="0.01" min="0" data-name="Internet">
                        </form>
                    </div>
                    
                    <div class="expense-category">
                        <h3>Transportation</h3>
                        <form class="expense-form">
                            <input type="number" placeholder="Car payment (optional)" step="0.01" min="0" data-name="Car Payment">
                            <input type="number" placeholder="Insurance (optional)" step="0.01" min="0" data-name="Car Insurance">
                            <input type="number" placeholder="Gas/Transit (optional)" step="0.01" min="0" data-name="Gas/Transit">
                        </form>
                    </div>
                    
                    <div class="expense-category">
                        <h3>Other</h3>
                        <form class="expense-form">
                            <input type="number" placeholder="Phone bill (optional)" step="0.01" min="0" data-name="Phone">
                            <input type="number" placeholder="Subscriptions (optional)" step="0.01" min="0" data-name="Subscriptions">
                            <input type="number" placeholder="Other expense (optional)" step="0.01" min="0" data-name="Other">
                        </form>
                    </div>
                </div>
                
                <div class="onboarding-buttons">
                    <button type="button" class="onboarding-btn secondary" onclick="budgetTracker.onboarding.goBack()">Back</button>
                    <button type="button" class="onboarding-btn primary" onclick="budgetTracker.onboarding.finishExpenses()">Continue</button>
                </div>
            </div>

            <!-- Final Summary -->
            <div id="onboarding-final-summary" class="onboarding-step">
                <h2>You're Ready!</h2>
                <div class="summary-breakdown">
                    <p>Ok, so every month you have:</p>
                    <div class="summary-line income">
                        <span>Income:</span>
                        <span id="finalIncomeAmount">$0</span>
                    </div>
                    <div class="summary-line expenses">
                        <span>Expenses:</span>
                        <span id="finalExpensesAmount">$0</span>
                    </div>
                    <hr>
                    <div class="summary-line leftover">
                        <span>Left to spend:</span>
                        <span id="finalLeftoverAmount">$0</span>
                    </div>
                </div>
                <p class="instructions">Any time you spend money, open this app and add the money you spent. That's all.</p>
                <p class="peace-of-mind">You'll find this gives you peace of mind - you'll always know where you stand financially.</p>
                <div class="onboarding-buttons">
                    <button class="onboarding-btn secondary" onclick="budgetTracker.onboarding.goBack()">Back</button>
                    <button class="onboarding-btn primary" onclick="budgetTracker.onboarding.finishOnboarding()">Start budgeting!</button>
                </div>
            </div>

            <!-- Completion -->
            <div id="onboarding-complete" class="onboarding-step">
                <h2>You're all set!</h2>
                <p>Great! Your budget is ready. You can now start tracking your daily spending and see how much you have left each month.</p>
                <div class="onboarding-buttons">
                    <button class="onboarding-btn primary" onclick="budgetTracker.onboarding.finishOnboarding()">Start budgeting!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="auth-overlay" style="display: none;">
        <div class="auth-modal">
            <div id="auth-welcome" class="auth-step active">
                <h2>Welcome to Budget Tracker</h2>
                <p>Choose how you'd like to get started:</p>
                <div class="auth-buttons">
                    <button class="auth-btn primary" onclick="budgetTracker.auth.showLogin()">Sign In</button>
                    <button class="auth-btn primary" onclick="budgetTracker.auth.showSignup()">Create Account</button>
                    <button class="auth-btn guest" onclick="budgetTracker.auth.continueAsGuest()">Continue as Guest</button>
                </div>
                <div class="auth-info">
                    <p class="guest-info">As a guest, your data is saved locally. You can create an account anytime to sync across devices.</p>
                </div>
            </div>

            <div id="auth-login" class="auth-step">
                <h2>Welcome Back</h2>
                <p>Sign in to sync your budget across all devices</p>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <div class="auth-buttons">
                        <button type="submit" class="auth-btn primary">Sign In</button>
                        <button type="button" class="auth-btn secondary" onclick="budgetTracker.auth.showWelcome()">Back</button>
                    </div>
                </form>
            </div>

            <div id="auth-signup" class="auth-step">
                <h2>Create Account</h2>
                <p>Sync your budget data across all your devices</p>
                <form id="signupForm">
                    <div class="form-group">
                        <label for="signupEmail">Email:</label>
                        <input type="email" id="signupEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password:</label>
                        <input type="password" id="signupPassword" minlength="6" required>
                    </div>
                    <div class="auth-buttons">
                        <button type="submit" class="auth-btn primary">Create Account</button>
                        <button type="button" class="auth-btn secondary" onclick="budgetTracker.auth.showWelcome()">Back</button>
                    </div>
                </form>
            </div>

            <div id="auth-loading" class="auth-step">
                <h2>Setting up your account...</h2>
                <div class="auth-spinner"></div>
            </div>
        </div>
    </div>

    <!-- Month Archive Modal -->
    <div id="monthArchiveModal" class="month-archive-overlay" style="display: none;">
        <div class="month-archive-modal">
            <h2>New Month Detected!</h2>
            <p>It's now <span id="newMonthName"></span>. Would you like to archive <span id="oldMonthName"></span> and start fresh?</p>
            <div class="archive-summary">
                <div class="archive-line">
                    <span>Total spent last month:</span>
                    <span id="lastMonthSpent">$0.00</span>
                </div>
                <div class="archive-line">
                    <span>Budget remaining:</span>
                    <span id="lastMonthRemaining">$0.00</span>
                </div>
            </div>
            <div class="archive-buttons">
                <button class="archive-btn primary" onclick="budgetTracker.archiveMonth()">Archive & Start New Month</button>
                <button class="archive-btn secondary" onclick="budgetTracker.continueCurrentMonth()">Continue Current Month</button>
            </div>
        </div>
    </div>

    <!-- Upgrade Account Modal -->
    <div id="upgradeModal" class="upgrade-overlay" style="display: none;">
        <div class="upgrade-modal">
            <h2>Create Your Account</h2>
            <p>Create an account to sync your budget across all devices and access it anywhere!</p>
            <div class="upgrade-benefits">
                <div class="benefit">
                    <span class="benefit-icon">☁️</span>
                    <span>Sync across all devices</span>
                </div>
                <div class="benefit">
                    <span class="benefit-icon">🔒</span>
                    <span>Secure cloud backup</span>
                </div>
                <div class="benefit">
                    <span class="benefit-icon">📱</span>
                    <span>Access anywhere</span>
                </div>
            </div>
            <form id="upgradeForm">
                <div class="form-group">
                    <label for="upgradeEmail">Email:</label>
                    <input type="email" id="upgradeEmail" required>
                </div>
                <div class="form-group">
                    <label for="upgradePassword">Password:</label>
                    <input type="password" id="upgradePassword" minlength="6" required>
                </div>
                <div class="upgrade-buttons">
                    <button type="submit" class="upgrade-btn-modal primary">Create Account</button>
                    <button type="button" class="upgrade-btn-modal secondary" onclick="budgetTracker.backToAuthFromUpgrade()">Back</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>